(function(global,undefined){if(global.yi)return;var Yi=function(){this.relativePath="";this.themeManager=null;this.mod=new ModManager;this._readyCallbacks=[];var self=this;var ready=function(event){self._setup();if(typeof window.addEventListener!="undefined")window.removeEventListener("load",ready,false);else window.detachEvent("onload",ready)};if(typeof window.addEventListener!="undefined")window.addEventListener("load",ready,false);else window.attachEvent("onload",ready)};Yi.prototype.ready=function(callback){this._readyCallbacks.push(callback)};
Yi.prototype.config=function(relativePath,addition){this.relativePath=relativePath;this.mod.context=relativePath;var alias=addition!==undefined?addition:{};alias["class"]="utils/class.js";alias["map"]="utils/hashmap.js";alias["console"]="core/console/console.js";alias["dialog"]="plugins/bootbox.min.js";alias["menu-aim"]="plugins/jquery.menu-aim.js";alias["fetch"]="plugins/fetch/jquery.fetch.js";alias["theme-manager"]="modules/misc/theme-manager.min.js";common.config({base:relativePath+"lib/",alias:alias})};
Yi.prototype._setup=function(){var readyCount=0;var readyConst=3;var self=this;common.use("theme-manager",function(ThemeManager){self.themeManager=new ThemeManager;checkReady()});common.use("dialog",function(){bootbox.setDefaults({locale:"zh_CN"});checkReady()});common.use("fetch",function(){checkReady()});function checkReady(){++readyCount;if(readyCount==readyConst)if(self._readyCallbacks.length>0)for(var i=0;i<self._readyCallbacks.length;++i){var cb=self._readyCallbacks[i];cb.call(null,self)}}};
Yi.prototype.alert=function(message,callback){bootbox.alert(message,callback)};Yi.prototype.confirm=function(message,callback){bootbox.confirm(message,callback)};Yi.prototype.prompt=function(title,callback){bootbox.prompt(title,callback)};Yi.prototype.dialog=function(options){bootbox.dialog(options)};var ModManager=function(){this.context=""};ModManager.prototype.load=function(container,args){var target=container;if(typeof target=="string")target=$("#"+container);var modName=target.data("mod");if(modName===
undefined){console.log('[Yi#Mod] Can not find "data-mod" attribute value.');return}var version=target.data("modVer");if(version===undefined){console.log('[Yi#Mod] Can not find "data-mod-ver" attribute value.');return}var url=this.context+"modloader"+"/"+modName+"/"+version;$.post(url,function(data,textStatus,jqXHR){if(args!==undefined)data["args"]=args;target.fetch(data)},"json").fail(function(){console.log('[Yi#Mod] Failed requests "'+url+'".')})};ModManager.prototype.debug=function(containerId,
mod){var container=$("#"+containerId);container.fetch(mod)};global.yi=new Yi})(this);
